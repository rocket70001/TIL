# JPA - 0629(JPQL 중급 문법)  

## 중요!!! fetch join
SQL 조인 종류가 아니다. JPQL에서 성능 최적화를 위해 제공하는 기능이며 연관된 엔티티나 컬렉션을  
SQL 한 번에 함께 조회한다. join fetch 명령어를 사용  
N + 1 문제를 해결하기 위해 사용한다.  
패치 조인과 일반 조인의 차이는 연관 엔티티를 함께 조회하는가 조회하지 않는가 여부에 따라 달라진다.  
  
-> 패치조인은 한방 쿼리로 연관된 객체 그래프를 모두 탐색하는 JPQL이다.  
패치 조인에는 별칭을 줄 수 없으며(하이버네이트는 가능하지만 사용하지 않는 게 좋다.) 둘 이상의 컬렉션은 패치 조인을 할 수 없다. 또 컬렉션을 패치 조인하면 페이징API를 사용할 수 없다. 
  
조건절을 두어 패치 조인하는 테이블 데이터의 일부를 조회하고자 한다면 페치 조인을 쓰면 안 된다. 패치 조인은 연관 데이터를 모두 가져오기 위해 사용하는 조인이지 일반 조인과 같이 조건절 하에 특정 데이터만을 골라내는 조인이 아니다.  
케스케이드나 특별한 옵션이 붙어있는 경우 패치 조인을 하고 특정 데이터를 걸러 조회를 할 때 예상치 못한 결과가 나올 수 있다. 따라서 패치 조인에는 가능한한 별칭, 조건절을 두지 않는 게 좋다. 

페치 조인의 성능상 이점을 최대한 활용하자  
  
## 벌크 연산
쿼리 한 번으로 여러 테이블 로우를 변경하면 벌크 연산이다. 
영속성 컨텍스트를 무시하고 DB에 직접 쿼리하기 때문에 주의해야 한다.  
벌크 연산을 먼저 실행하거나, 벌크 연산을 실행하고 영속성 컨텍스트를 초기화하는 방식으로 쓰자.  

